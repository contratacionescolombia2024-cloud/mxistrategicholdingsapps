
# ๐ Diagrama de Flujo: Sistema de Reset de Usuarios

## ๐ Flujo Principal

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    INICIO DEL PROCESO                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Usuario accede al Panel de Administraciรณn                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
                    โโโโโโโโโโโโโโโโโโโ
                    โ ยฟEs Admin?      โ
                    โโโโโโโโโโโโโโโโโโโ
                       โ           โ
                    Sร โ           โ NO
                       โ           โ
                       โ           โผ
                       โ    โโโโโโโโโโโโโโโโโโโโ
                       โ    โ Acceso Denegado  โ
                       โ    โ Redirect a Home  โ
                       โ    โโโโโโโโโโโโโโโโโโโโ
                       โ           โ
                       โ           โผ
                       โ        [FIN]
                       โ
                       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Panel Admin carga con Zona de Peligro visible              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Usuario hace clic en "Reiniciar Todos los Usuarios"        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Se abre Modal de Confirmaciรณn                              โ
โ  - Icono de advertencia                                     โ
โ  - Lista de advertencias                                    โ
โ  - Campo de confirmaciรณn                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
                    โโโโโโโโโโโโโโโโโโโ
                    โ Usuario lee     โ
                    โ advertencias    โ
                    โโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
                    โโโโโโโโโโโโโโโโโโโ
                    โ ยฟDesea          โ
                    โ continuar?      โ
                    โโโโโโโโโโโโโโโโโโโ
                       โ           โ
                    Sร โ           โ NO
                       โ           โ
                       โ           โผ
                       โ    โโโโโโโโโโโโโโโโโโโโ
                       โ    โ Clic en Cancelar โ
                       โ    โ Cierra modal     โ
                       โ    โโโโโโโโโโโโโโโโโโโโ
                       โ           โ
                       โ           โผ
                       โ        [FIN]
                       โ
                       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Usuario escribe en campo de confirmaciรณn                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
                    โโโโโโโโโโโโโโโโโโโ
                    โ Texto ==        โ
                    โ "RESETEAR"?     โ
                    โโโโโโโโโโโโโโโโโโโ
                       โ           โ
                    Sร โ           โ NO
                       โ           โ
                       โ           โผ
                       โ    โโโโโโโโโโโโโโโโโโโโ
                       โ    โ Botรณn Confirmar  โ
                       โ    โ permanece        โ
                       โ    โ deshabilitado    โ
                       โ    โโโโโโโโโโโโโโโโโโโโ
                       โ           โ
                       โ           โผ
                       โ    [Espera input]
                       โ
                       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Botรณn "Confirmar Reset" se habilita                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Usuario hace clic en "Confirmar Reset"                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Estado: resetting = true                                   โ
โ  Muestra ActivityIndicator                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Llama a supabase.rpc('admin_reset_all_users')              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
                    โโโโโโโโโโโโโโโโโโโ
                    โ Funciรณn SQL     โ
                    โ ejecuta         โ
                    โโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
                    โโโโโโโโโโโโโโโโโโโ
                    โ ยฟรxito?         โ
                    โโโโโโโโโโโโโโโโโโโ
                       โ           โ
                    Sร โ           โ NO
                       โ           โ
                       โ           โผ
                       โ    โโโโโโโโโโโโโโโโโโโโ
                       โ    โ Muestra Alert    โ
                       โ    โ con error        โ
                       โ    โโโโโโโโโโโโโโโโโโโโ
                       โ           โ
                       โ           โผ
                       โ    โโโโโโโโโโโโโโโโโโโโ
                       โ    โ resetting=false  โ
                       โ    โ Modal abierto    โ
                       โ    โโโโโโโโโโโโโโโโโโโโ
                       โ           โ
                       โ           โผ
                       โ    [Usuario puede     
                       โ     reintentar]
                       โ
                       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Muestra Alert de รxito                                     โ
โ  "โ Sistema reiniciado exitosamente. X usuarios            โ
โ   reseteados a 0."                                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Usuario hace clic en "OK"                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  - Cierra modal                                             โ
โ  - Limpia confirmationText                                  โ
โ  - Llama a loadStats()                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Panel Admin se actualiza con nuevas estadรญsticas           โ
โ  - Total Usuarios: X                                        โ
โ  - Total MXI: 0                                             โ
โ  - Total USDT: 0                                            โ
โ  - Activos: 0                                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      FIN DEL PROCESO                         โ
โ                   Sistema listo para preventa                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ง Flujo de la Funciรณn SQL

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  admin_reset_all_users(p_admin_id UUID)                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 1: Verificar Permisos                                 โ
โ  SELECT EXISTS FROM admin_users WHERE user_id = p_admin_id  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
                    โโโโโโโโโโโโโโโโโโโ
                    โ ยฟEs Admin?      โ
                    โโโโโโโโโโโโโโโโโโโ
                       โ           โ
                    Sร โ           โ NO
                       โ           โ
                       โ           โผ
                       โ    โโโโโโโโโโโโโโโโโโโโ
                       โ    โ RETURN           โ
                       โ    โ success: false   โ
                       โ    โ error: "No       โ
                       โ    โ permisos"        โ
                       โ    โโโโโโโโโโโโโโโโโโโโ
                       โ           โ
                       โ           โผ
                       โ        [FIN]
                       โ
                       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 2: Contar Usuarios                                    โ
โ  SELECT COUNT(*) INTO v_users_count FROM users              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 3: Resetear Usuarios                                  โ
โ  UPDATE users SET                                           โ
โ    mxi_balance = 0,                                         โ
โ    usdt_contributed = 0,                                    โ
โ    mxi_purchased_directly = 0,                              โ
โ    mxi_from_unified_commissions = 0,                        โ
โ    mxi_from_challenges = 0,                                 โ
โ    mxi_vesting_locked = 0,                                  โ
โ    active_referrals = 0,                                    โ
โ    is_active_contributor = false,                           โ
โ    can_withdraw = false,                                    โ
โ    yield_rate_per_minute = 0,                               โ
โ    accumulated_yield = 0                                    โ
โ  WHERE id != p_admin_id                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 4: Limpiar Tablas                                     โ
โ  DELETE FROM commissions                                    โ
โ  DELETE FROM referrals                                      โ
โ  DELETE FROM contributions                                  โ
โ  DELETE FROM withdrawals                                    โ
โ  DELETE FROM challenge_history                              โ
โ  DELETE FROM lottery_tickets                                โ
โ  DELETE FROM game_participants                              โ
โ  DELETE FROM game_results                                   โ
โ  DELETE FROM game_sessions                                  โ
โ  DELETE FROM nowpayments_orders                             โ
โ  DELETE FROM mxi_withdrawal_schedule                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 5: Resetear Mรฉtricas                                  โ
โ  UPDATE metrics SET                                         โ
โ    total_members = 56527,                                   โ
โ    total_usdt_contributed = 0,                              โ
โ    total_mxi_distributed = 0,                               โ
โ    total_tokens_sold = 0,                                   โ
โ    current_phase = 1,                                       โ
โ    current_price_usdt = 0.30,                               โ
โ    phase_1_tokens_sold = 0,                                 โ
โ    phase_2_tokens_sold = 0,                                 โ
โ    phase_3_tokens_sold = 0                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 6: Retornar Resultado                                 โ
โ  RETURN jsonb_build_object(                                 โ
โ    'success', true,                                         โ
โ    'message', 'โ Sistema reiniciado...',                   โ
โ    'users_reset', v_users_count                             โ
โ  )                                                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
                    โโโโโโโโโโโโโโโโโโโ
                    โ ยฟError?         โ
                    โโโโโโโโโโโโโโโโโโโ
                       โ           โ
                    NO โ           โ Sร
                       โ           โ
                       โ           โผ
                       โ    โโโโโโโโโโโโโโโโโโโโ
                       โ    โ EXCEPTION        โ
                       โ    โ ROLLBACK         โ
                       โ    โ RETURN error     โ
                       โ    โโโโโโโโโโโโโโโโโโโโ
                       โ
                       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Resultado exitoso retornado al cliente                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐จ Flujo de UI/UX

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    EXPERIENCIA VISUAL                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ESTADO 1: Panel Admin Normal
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Panel de Administraciรณn            โ
โ Bienvenido, Admin                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ [Universal MXI Counter]            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ โ๏ธ ZONA DE PELIGRO                 โ
โ Reinicia todos los contadores...   โ
โ [๐ Reiniciar Todos los Usuarios]  โ โ BOTรN ROJO
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ Mรฉtricas de Preventa               โ
โ ...                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ
                โ CLIC
                โผ

ESTADO 2: Modal de Confirmaciรณn
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ [OVERLAY OSCURO 80%]               โ
โ                                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ     โ๏ธ [ICONO GRANDE]        โ โ
โ  โ                              โ โ
โ  โ ยฟReiniciar Todos los         โ โ
โ  โ Usuarios?                    โ โ
โ  โ                              โ โ
โ  โ Esta acciรณn es IRREVERSIBLE  โ โ
โ  โ                              โ โ
โ  โ โข Saldos MXI โ 0             โ โ
โ  โ โข Comisiones eliminadas      โ โ
โ  โ โข Referidos eliminados       โ โ
โ  โ โข ...                        โ โ
โ  โ                              โ โ
โ  โ Escribe "RESETEAR":          โ โ
โ  โ [________________]           โ โ โ INPUT
โ  โ                              โ โ
โ  โ [Cancelar] [Confirmar Reset] โ โ
โ  โ             โ DESHABILITADO  โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ
                โ ESCRIBE "RESETEAR"
                โผ

ESTADO 3: Botรณn Habilitado
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ Escribe "RESETEAR":          โ โ
โ  โ [___RESETEAR____]            โ โ โ TEXTO CORRECTO
โ  โ                              โ โ
โ  โ [Cancelar] [Confirmar Reset] โ โ
โ  โ             โ HABILITADO     โ โ โ BOTรN ROJO ACTIVO
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ
                โ CLIC EN CONFIRMAR
                โผ

ESTADO 4: Procesando
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                              โ โ
โ  โ [Cancelar] [โณ Loading...]   โ โ โ SPINNER
โ  โ             โ DESHABILITADO  โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ
                โ ESPERA 2-5 SEG
                โผ

ESTADO 5: รxito
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ [ALERT NATIVO]                     โ
โ                                    โ
โ  โ Sistema Reiniciado             โ
โ                                    โ
โ  Sistema reiniciado exitosamente.  โ
โ  7 usuarios reseteados a 0.        โ
โ                                    โ
โ           [OK]                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ
                โ CLIC EN OK
                โผ

ESTADO 6: Panel Actualizado
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Panel de Administraciรณn            โ
โ Bienvenido, Admin                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ [Universal MXI Counter]            โ
โ Total: 0 MXI                       โ โ ACTUALIZADO
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ โ๏ธ ZONA DE PELIGRO                 โ
โ [๐ Reiniciar Todos los Usuarios]  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ Usuarios: 7                        โ
โ Activos: 0                         โ โ ACTUALIZADO
โ Total USDT: 0                      โ โ ACTUALIZADO
โ Total MXI: 0                       โ โ ACTUALIZADO
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Flujo de Seguridad

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    CAPAS DE SEGURIDAD                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

CAPA 1: Autenticaciรณn
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Usuario intenta acceder            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ
                โผ
        โโโโโโโโโโโโโโโโโ
        โ ยฟAutenticado? โ
        โโโโโโโโโโโโโโโโโ
         โ           โ
      Sร โ           โ NO
         โ           โผ
         โ    [Redirect Login]
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ CAPA 2: Autorizaciรณn               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ
                โผ
        โโโโโโโโโโโโโโโโโ
        โ ยฟEs Admin?    โ
        โ (admin_users) โ
        โโโโโโโโโโโโโโโโโ
         โ           โ
      Sร โ           โ NO
         โ           โผ
         โ    [Acceso Denegado]
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ CAPA 3: Confirmaciรณn UI            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ
                โผ
        โโโโโโโโโโโโโโโโโ
        โ Modal abierto โ
        โ Advertencias  โ
        โโโโโโโโโโโโโโโโโ
                โ
                โผ
        โโโโโโโโโโโโโโโโโ
        โ Texto ==      โ
        โ "RESETEAR"?   โ
        โโโโโโโโโโโโโโโโโ
         โ           โ
      Sร โ           โ NO
         โ           โผ
         โ    [Botรณn Deshabilitado]
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ CAPA 4: Validaciรณn Backend        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ
                โผ
        โโโโโโโโโโโโโโโโโ
        โ Verifica      โ
        โ p_admin_id    โ
        โ en DB         โ
        โโโโโโโโโโโโโโโโโ
         โ           โ
      Sร โ           โ NO
         โ           โผ
         โ    [Error: No permisos]
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ CAPA 5: Transacciรณn Atรณmica       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ
                โผ
        โโโโโโโโโโโโโโโโโ
        โ BEGIN         โ
        โ ...           โ
        โ COMMIT        โ
        โโโโโโโโโโโโโโโโโ
         โ           โ
    รXITOโ           โ ERROR
         โ           โผ
         โ    โโโโโโโโโโโโโโโโโ
         โ    โ ROLLBACK      โ
         โ    โ Sin cambios   โ
         โ    โโโโโโโโโโโโโโโโโ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ CAPA 6: Protecciรณn de Admin       โ
โ WHERE id != p_admin_id             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ
                โผ
        [Reset Exitoso]
```

---

## ๐ Flujo de Datos

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    TRANSFORMACIรN DE DATOS                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ANTES DEL RESET:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ users                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ id: uuid-1                         โ
โ mxi_balance: 1500.50               โ
โ usdt_contributed: 500.00           โ
โ mxi_purchased_directly: 1000.00    โ
โ mxi_from_commissions: 300.50       โ
โ mxi_from_challenges: 200.00        โ
โ active_referrals: 5                โ
โ is_active_contributor: true        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ
                โ RESET
                โผ
DESPUรS DEL RESET:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ users                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ id: uuid-1                         โ
โ mxi_balance: 0                     โ โ RESETEADO
โ usdt_contributed: 0                โ โ RESETEADO
โ mxi_purchased_directly: 0          โ โ RESETEADO
โ mxi_from_commissions: 0            โ โ RESETEADO
โ mxi_from_challenges: 0             โ โ RESETEADO
โ active_referrals: 0                โ โ RESETEADO
โ is_active_contributor: false       โ โ RESETEADO
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

TABLAS RELACIONADAS:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ commissions: 150 rows              โ
โ referrals: 75 rows                 โ
โ contributions: 200 rows            โ
โ withdrawals: 10 rows               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ
                โ DELETE
                โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ commissions: 0 rows                โ โ LIMPIADO
โ referrals: 0 rows                  โ โ LIMPIADO
โ contributions: 0 rows              โ โ LIMPIADO
โ withdrawals: 0 rows                โ โ LIMPIADO
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

MรTRICAS:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ metrics                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ total_tokens_sold: 2565897         โ
โ current_phase: 2                   โ
โ phase_1_tokens_sold: 1500000       โ
โ phase_2_tokens_sold: 1065897       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ
                โ RESET
                โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ metrics                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ total_tokens_sold: 0               โ โ RESETEADO
โ current_phase: 1                   โ โ RESETEADO
โ phase_1_tokens_sold: 0             โ โ RESETEADO
โ phase_2_tokens_sold: 0             โ โ RESETEADO
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## โฑ๏ธ Lรญnea de Tiempo

```
T=0s    Usuario abre Panel Admin
        โ
T=1s    Carga estadรญsticas
        โ
T=2s    Usuario ve Zona de Peligro
        โ
T=5s    Usuario hace clic en Reset
        โ
T=5.1s  Modal se abre
        โ
T=10s   Usuario lee advertencias
        โ
T=15s   Usuario escribe "RESETEAR"
        โ
T=16s   Botรณn se habilita
        โ
T=17s   Usuario hace clic en Confirmar
        โ
T=17.1s Inicia ejecuciรณn de funciรณn SQL
        โ
T=17.2s Verifica permisos โ
        โ
T=17.3s Cuenta usuarios โ
        โ
T=18s   Resetea usuarios โ
        โ
T=19s   Limpia tablas โ
        โ
T=20s   Resetea mรฉtricas โ
        โ
T=20.1s Retorna resultado โ
        โ
T=20.2s Muestra Alert de รฉxito
        โ
T=22s   Usuario hace clic en OK
        โ
T=22.1s Cierra modal
        โ
T=22.2s Recarga estadรญsticas
        โ
T=23s   Panel actualizado
        โ
T=24s   [PROCESO COMPLETO]
```

---

**Este diagrama de flujo proporciona una visualizaciรณn completa del proceso de reset, desde la perspectiva del usuario, la base de datos, la seguridad y los datos. ๐**
